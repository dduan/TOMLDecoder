{"abstract":[{"text":"Notes for TOMLDecoder maintainers.","type":"text"}],"hierarchy":{"paths":[["doc://TOMLDecoder/documentation/TOMLDecoder"]]},"identifier":{"interfaceLanguage":"swift","url":"doc://TOMLDecoder/documentation/TOMLDecoder/DevelopingTOMLDecoder"},"kind":"article","metadata":{"modules":[{"name":"TOMLDecoder"}],"role":"article","roleHeading":"Article","title":"Developing TOMLDecoder"},"primaryContentSections":[{"content":[{"anchor":"Writing-Code","level":2,"text":"Writing Code","type":"heading"},{"inlineContent":[{"text":"Use ","type":"text"},{"identifier":"https://github.com/nicklockwood/SwiftFormat/tree/main","isActive":true,"type":"reference"},{"text":",","type":"text"},{"text":" ","type":"text"},{"text":"ideally, the version specified in ","type":"text"},{"code":"Scripts/format.sh","type":"codeVoice"},{"text":" to format all code.","type":"text"},{"text":" ","type":"text"},{"text":"Patches containing unformatted code should not be accepted.","type":"text"},{"text":" ","type":"text"},{"text":"We recommend adding ","type":"text"},{"code":"swiftformat --lint .","type":"codeVoice"},{"text":" in git pre-commit hooks.","type":"text"}],"type":"paragraph"},{"anchor":"Writing-documentation","level":2,"text":"Writing documentation","type":"heading"},{"inlineContent":[{"text":"All APIs should be documented.","type":"text"},{"text":" ","type":"text"},{"text":"Documentation should use Semantic Line Breaks.","type":"text"},{"text":" ","type":"text"},{"text":"This applies to docstrings, code comments, and articles.","type":"text"},{"text":" ","type":"text"},{"text":"In short, at most one sentence per line.","type":"text"},{"text":" ","type":"text"},{"text":"Read https://sembr.org/ for more info.","type":"text"}],"type":"paragraph"},{"anchor":"Testing","level":2,"text":"Testing","type":"heading"},{"inlineContent":[{"text":"Write tests with Swift’s Testing framework.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Our unit tests include the ","type":"text"},{"identifier":"https://github.com/toml-lang/toml-test","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"from the TOML GitHub organization,","type":"text"},{"text":" ","type":"text"},{"text":"systematically translated into Swift tests.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Run tests with ","type":"text"},{"code":"swift test","type":"codeVoice"},{"text":", as well as ","type":"text"},{"code":"bazel test //...","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Tests must pass on macOS, Ubuntu, and Windows for any changes to land.","type":"text"}],"type":"paragraph"},{"anchor":"Generating-Code-and-Tests","level":2,"text":"Generating Code, and Tests","type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"Parts of the code are written using ","type":"text"},{"code":"gyb","type":"codeVoice"},{"text":".","type":"text"},{"text":" ","type":"text"},{"text":"Use the script ","type":"text"},{"code":"Scripts/generate-code.sh","type":"codeVoice"},{"text":" to generate the code.","type":"text"},{"text":" ","type":"text"},{"text":"The generated code is checked into the repo.","type":"text"},{"text":" ","type":"text"},{"text":"Look for header comments indicating generated code,","type":"text"},{"text":" ","type":"text"},{"text":"and only make changes in the corresponding ","type":"text"},{"code":".gyb","type":"codeVoice"},{"text":" files during development.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"A subset of tests are generated","type":"text"},{"text":" ","type":"text"},{"text":"by directly copying fixtures for the official test suite.","type":"text"},{"text":" ","type":"text"},{"text":"This is done by a script ","type":"text"},{"code":"Scripts/generate-tests.py","type":"codeVoice"},{"text":".","type":"text"},{"text":" ","type":"text"},{"text":"The generated tests and fixtures are checked into the repo.","type":"text"},{"text":" ","type":"text"},{"text":"The script contains a SHA of the test suite repo","type":"text"},{"text":" ","type":"text"},{"text":"from which the tests are copied.","type":"text"},{"text":" ","type":"text"},{"text":"Update the SHA to get potential newer tests.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"The script ","type":"text"},{"code":"Scripts/test-generate.sh","type":"codeVoice"},{"text":" should be run","type":"text"},{"text":" ","type":"text"},{"text":"to verify that the generated code and tests are up to date.","type":"text"},{"text":" ","type":"text"},{"text":"It exits with a non-zero exit code if new code is generated.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Generated source files should have ","type":"text"},{"code":".Generated.swift","type":"codeVoice"},{"text":" suffix in the filename.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Benchmarking","level":2,"text":"Benchmarking","type":"heading"},{"inlineContent":[{"text":"Use ","type":"text"},{"code":"Scripts/benchmark.sh baseline-SHA new-SHA","type":"codeVoice"},{"text":" ","type":"text"},{"text":"to compare performance between two commits.","type":"text"}],"type":"paragraph"},{"anchor":"Releasing","level":2,"text":"Releasing","type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"Pick a new version number according to ","type":"text"},{"identifier":"https://semver.org/","isActive":true,"type":"reference"},{"text":".","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Places referencing the latest version need to be updated:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Instructions for adding TOMLDecoder as a SwiftPM dependency","type":"text"},{"text":" ","type":"text"},{"text":"in Getting Started.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"MODULE.bazel","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Potentially other places.","type":"text"},{"text":" ","type":"text"},{"text":"Search for the old version number in the repo.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"inlineContent":[{"text":"In CHANGELOG.md, create section for the new release.","type":"text"},{"text":" ","type":"text"},{"text":"Move any content under ","type":"text"},{"code":"Development","type":"codeVoice"},{"text":" to the new section.","type":"text"},{"text":" ","type":"text"},{"text":"Note any changes that aren’t in the existing notes.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Check in the above changes and land the commit to the ","type":"text"},{"code":"main","type":"codeVoice"},{"text":" branch.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Tag the commit on ","type":"text"},{"code":"main","type":"codeVoice"},{"text":" created from the previous step.","type":"text"},{"text":" ","type":"text"},{"text":"The tag should be the literal version number (No ","type":"text"},{"code":"v","type":"codeVoice"},{"text":" prefix).","type":"text"},{"text":" ","type":"text"},{"text":"Push the tag to GitHub.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Create a draft release referencing the tag on GitHub.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Download all source archives included in the release in an empty directory.","type":"text"},{"text":" ","type":"text"},{"text":"Run ","type":"text"},{"code":"shasum -a 256 *","type":"codeVoice"},{"text":".","type":"text"},{"text":" ","type":"text"},{"text":"Include the output as a code block in the release notes.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Publish the release on GitHub.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Architecture-Overview","level":2,"text":"Architecture Overview","type":"heading"},{"inlineContent":[{"text":"TOMLDecoder is a parser with a ","type":"text"},{"code":"Swift.Decoder","type":"codeVoice"},{"text":" implementation sitting on top.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"TOML has a spec,","type":"text"},{"text":" ","type":"text"},{"text":"and a large number of parser implementations in many languages.","type":"text"},{"text":" ","type":"text"},{"text":"Among them,","type":"text"},{"text":" ","type":"text"},{"text":"TOMLDecoder’s parser is of the garden variety.","type":"text"},{"text":" ","type":"text"},{"text":"The parsing occurs in 2 stages,","type":"text"},{"text":" ","type":"text"},{"text":"each triggered by different API calls.","type":"text"},{"text":" ","type":"text"},{"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder/DeserializingTOML#The-Deserialization-Process","isActive":true,"type":"reference"},{"text":" describes this at a high level.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"When we make a ","type":"text"},{"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder/TOMLTable","isActive":true,"type":"reference"},{"text":" out of the TOML document,","type":"text"},{"text":" ","type":"text"},{"text":"we analyze the structure of the document,","type":"text"},{"text":" ","type":"text"},{"text":"find out where the key-value pairs are,","type":"text"},{"text":" ","type":"text"},{"text":"the tables, and the arrays.","type":"text"},{"text":" ","type":"text"},{"text":"Crucially,","type":"text"},{"text":" ","type":"text"},{"text":"we don’t attempt to validate the leaf values in","type":"text"},{"text":" ","type":"text"},{"text":"tables or arrays.","type":"text"},{"text":" ","type":"text"},{"text":"This validation is deferred as these leaf values are needed","type":"text"},{"text":" ","type":"text"},{"text":"by the decoder,","type":"text"},{"text":" ","type":"text"},{"text":"or requested by the user via,","type":"text"},{"text":" ","type":"text"},{"text":"for example,","type":"text"},{"text":" ","type":"text"},{"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder/TOMLTable/string(forKey:)","isActive":true,"type":"reference"},{"text":".","type":"text"}],"type":"paragraph"}],"kind":"content"}],"references":{"doc://TOMLDecoder/documentation/TOMLDecoder":{"abstract":[{"text":"TOML:","type":"text"},{"text":" ","type":"text"},{"text":"“a minimal configuration file format that’s easy to read due to obvious semantics”.","type":"text"}],"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder","kind":"symbol","role":"collection","title":"TOMLDecoder","type":"topic","url":"/documentation/tomldecoder"},"doc://TOMLDecoder/documentation/TOMLDecoder/CHANGELOG":{"abstract":[{"text":"Also known as release notes.","type":"text"}],"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder/CHANGELOG","kind":"article","role":"article","title":"Changelog","type":"topic","url":"/documentation/tomldecoder/changelog"},"doc://TOMLDecoder/documentation/TOMLDecoder/DeserializingTOML#The-Deserialization-Process":{"abstract":[],"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder/DeserializingTOML#The-Deserialization-Process","kind":"section","title":"The Deserialization Process","type":"topic","url":"/documentation/tomldecoder/deserializingtoml#The-Deserialization-Process"},"doc://TOMLDecoder/documentation/TOMLDecoder/TOMLTable":{"abstract":[{"text":"A parsed TOML table. Entry point for parsing TOML data.","type":"text"},{"text":" ","type":"text"},{"text":"The root of a TOML document is always a table.","type":"text"}],"fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"TOMLTable"}],"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder/TOMLTable","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"TOMLTable"}],"role":"symbol","title":"TOMLTable","type":"topic","url":"/documentation/tomldecoder/tomltable"},"doc://TOMLDecoder/documentation/TOMLDecoder/TOMLTable/string(forKey:)":{"abstract":[{"text":"Access a string value for a given key.","type":"text"}],"fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"string"},{"kind":"text","text":"("},{"kind":"externalParam","text":"forKey"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"kind":"text","text":") "},{"kind":"keyword","text":"throws"},{"kind":"text","text":"("},{"kind":"typeIdentifier","preciseIdentifier":"s:11TOMLDecoder9TOMLErrorV","text":"TOMLError"},{"kind":"text","text":") -> "},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"}],"identifier":"doc://TOMLDecoder/documentation/TOMLDecoder/TOMLTable/string(forKey:)","kind":"symbol","role":"symbol","title":"string(forKey:)","type":"topic","url":"/documentation/tomldecoder/tomltable/string(forkey:)"},"https://github.com/nicklockwood/SwiftFormat/tree/main":{"identifier":"https://github.com/nicklockwood/SwiftFormat/tree/main","title":"swiftformat","titleInlineContent":[{"text":"swiftformat","type":"text"}],"type":"link","url":"https://github.com/nicklockwood/SwiftFormat/tree/main"},"https://github.com/toml-lang/toml-test":{"identifier":"https://github.com/toml-lang/toml-test","title":"official suite","titleInlineContent":[{"text":"official suite","type":"text"}],"type":"link","url":"https://github.com/toml-lang/toml-test"},"https://semver.org/":{"identifier":"https://semver.org/","title":"Semantic Versioning","titleInlineContent":[{"text":"Semantic Versioning","type":"text"}],"type":"link","url":"https://semver.org/"}},"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"seeAlsoSections":[{"anchor":"Other-resources","generated":true,"identifiers":["doc://TOMLDecoder/documentation/TOMLDecoder/CHANGELOG"],"title":"Other resources"}],"variants":[{"paths":["/documentation/tomldecoder/developingtomldecoder"],"traits":[{"interfaceLanguage":"swift"}]}]}
